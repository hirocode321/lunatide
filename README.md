# LunaTide (ルナタイド) 🌙✨

**LunaTide** は、天体観測、夜景撮影、釣り、そして月を愛するすべての人のために設計された、超高速・高精度の月齢＆潮汐情報プラットフォームです。

技術的な複雑さをバックエンドに閉じ込め、ユーザーには「速さ」と「心地よさ」という圧倒的な体験を提供することに特化しています。

---

## 🚀 圧倒的なパフォーマンス・特長

### 1. 瞬時のデータ検索 (Ultra-Fast Retrieval)
かつての重いCSV解析から、最適化された **SQLite データベース構造** へ移行。日本全国47都道府県、2025年〜2026年の膨大な天体データを、クリックした瞬間に表示します。待ち時間はほぼゼロ。あなたのインスピレーションを邪魔しません。

**LunaTide** は、天体観測、夜景撮影、釣り、そして月を愛するすべての人のために設計された、超高速・高精度の月齢・潮汐・気象統合プラットフォームです。
「いつ、どこで、最高の夜空に出会えるか」という問いに対し、高度な計算アルゴリズムと直感的なUIで答えを出します。

---

## 🚀 圧倒的な「脳」の仕組み (Technical Highlights)

LunaTideの裏側では、複数の高度なロジックが統合され、ユーザーの意思決定をサポートしています。

### 1. 独自アルゴリズム：星空指数 (Starry Sky Index)
単なる「晴れ・曇り」の予報ではなく、観測の質を数値化(0-100)します。
- **雲量解析**: Open-Meteo APIからの毎時の雲量データを基底値として採用。
- **気象コード補正**: 霧(45, 48)、完全な曇り(3)、雨・雪(50+)などの気象コードに応じ、指数をインテリジェントに減衰。
- **コアタイム推論**: 日没から日の出までの全データをスキャンし、最も指数が高い時間帯を「今夜の狙い目」として自動的にレコメンドします。

### 2. 高精度天体計算 (Astro-Calculation Engine)
Pythonの **Skyfield** ライブラリと **DE421 天体暦** を使用し、科学研究レベルの精度でデータを算出します。
- **任意座標対応**: 日本全国の市区町村だけでなく、マップ上でクリックした任意の緯度・経度における日の出入り、月の出入り、月齢を動的に計算。
- **ISS通過予測**: 観測地点に応じた国際宇宙ステーション(ISS)の通過時刻と最大高度をタイムラインに統合。

### 3. ハイブリッド・データマネジメント
- **SQLite 最適化**: 2025年〜2026年の膨大な潮汐・月齢データを構造化して保持。CSV解析を廃止し、ミリ秒単位のレスポンスを実現。
- **分散データベース**: ユーザーの問い合わせ（`inquiries.db`）と天文マスターデータ（`moon_data.db`）を分離し、堅牢性とメンテナンス性を向上。

### 4. インテリジェント・マップ統合 (Geo-Spatial Integration)
- **潮汐（海辺）マップ**: 海上の撮影スポットと、最寄りの検潮所の潮位データを結合して表示。
- **光害マップ（観測スポット一覧）**: 地点の暗さ（Bortle Class）に加え、その場所のリアルタイムな気象・天文データをモーダル内で一括確認可能。

### 5. 極限まで高めたUI/UX
- **シームレス・月齢シミュレーター**: JavaScriptによる月画像の **バックグラウンド・プリロード** 機能を搭載。スライダー操作に合わせて瞬時に画像が切り替わり、引っ掛かりのない「満ち欠け体験」を提供します。
- **レスポンシブ・タイムライン**: 天文イベントを月ごとに自動グルーピングし、重要なイベントを見逃さないためのバッジ表示やハイライト処理を施しています。

---

## 🎯 主な利用シーン

- **風景・天体カメラマン**: 「星空指数」と「月齢」を組み合わせ、天の川が最も美しく見える瞬間を特定。
- **釣り愛好家**: 潮汐のリズムと月の満ち欠け（大潮・小潮）を把握し、釣果の最大化を狙う。
- **ナイトアクティビティ**: 街明かりから離れた暗い場所（Bortle Class）探しと、その場所の天気を同時にチェック。

---

## 🛠 システム構成

- **Language**: Python 3.x
- **Framework**: Flask
- **Database**: SQLite3
- **External APIs**: 
  - [Open-Meteo](https://open-meteo.com/): 高精度気象・雲量データ
  - [Nominatim](https://nominatim.org/): 地名・住所のジオコーディング
- **Key Libraries**: Skyfield, Requests, Beautiful Soup 4 (Scraping)
- **Frontend**: Vanilla JS (ES6+), Leaflet.js (Interactive Maps), Bootstrap 5

---

## ⚙️ クイックスタート

```bash
# 依存関係のインストール
pip install -r requirements.txt

# アプリケーションの起動
python app.py
```

*LunaTide は、あなたの日常に夜空のリズムを。*
