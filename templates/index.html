{% extends "base.html" %}

{% block title %}月齢カレンダー{% endblock %}

{% block content %}
<div class="container my-5 calendar-container fade-in">
    <div class="text-center mb-5">
        <h1 class="display-5 font-weight-bold">{{ year }}年{{ month }}月</h1>
        <p class="text-secondary">月齢と星々が織りなす、今月のリズム</p>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{{ url_for('main.index', year=prev_year, month=prev_month) }}" class="btn btn-outline-light px-4">
            <i class="fas fa-chevron-left me-2"></i>前月
        </a>
        <div class="h4 mb-0 text-primary font-monospace">{{ year }}.{{ month }}</div>
        <a href="{{ url_for('main.index', year=next_year, month=next_month) }}" class="btn btn-outline-light px-4">
            次月<i class="fas fa-chevron-right ms-2"></i>
        </a>
    </div>

    <div class="calendar-grid">
        <!-- Weekday Headers -->
        <div class="calendar-header text-danger">SUN</div>
        <div class="calendar-header">MON</div>
        <div class="calendar-header">TUE</div>
        <div class="calendar-header">WED</div>
        <div class="calendar-header">THU</div>
        <div class="calendar-header">FRI</div>
        <div class="calendar-header text-primary">SAT</div>

        {% for day, weekday in days %}
        {% if day > 0 %}
        <div class="calendar-day 
                {% if year == today.year and month == today.month and day == today.day %}day-today{% endif %}
                {% if weekday == 0 %}text-danger{% elif weekday == 6 %}text-primary{% endif %}"
            data-bs-toggle="tooltip" data-bs-placement="top"
            title="{% if day in events_by_day %}{{ events_by_day[day].title }}{% else %}月齢: {{ moon_ages[loop.index0] or '-' }}{% endif %}">

            <div class="day-number">{{ day }}</div>

            <div class="moon-info">
                {% if moon_images[loop.index0] %}
                <img src="{{ url_for('static', filename=moon_images[loop.index0]) }}" alt="Moon Phase"
                    class="moon-img-sm">
                <div class="moon-age-text d-none d-md-block">{{ moon_ages[loop.index0] }}</div>
                {% else %}
                <div style="height: 32px;"></div>
                {% endif %}
            </div>

            {% if day in events_by_day %}
            <div class="event-marker">
                <i class="fas fa-star"></i>
            </div>
            {% endif %}
        </div>
        {% else %}
        <div class="calendar-day opacity-25" style="background: transparent; border: none;"></div>
        {% endif %}
        {% endfor %}
    </div>

    <!-- Instructions / Legend -->
    <div class="mt-5 text-center small text-secondary">
        <span class="me-3"><i class="fas fa-star text-warning me-1"></i> 特別な天体イベント</span>
        <span><i class="far fa-circle me-1"></i> 日付をクリックで詳細を表示（予定）</span>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });
</script>
{% endblock %}